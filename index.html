<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Stok Kaos Polos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #4CAF50;
            padding: 10px 20px;
            color: white;
        }
        .header img {
            height: 50px;
        }
        .login-btn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .login-btn:hover {
            background-color: #45a049;
        }
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .form-grid > div {
            display: contents;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f9f9f9;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .hidden {
            display: none;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .logout-btn {
            background-color: #f44336;
        }
        .notification {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            color: white;
        }
        .notification.success {
            background-color: #4CAF50;
        }
        .notification.error {
            background-color: #f44336;
        }
        .customer-notice {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border: 1px solid #ffeeba;
        }
    </style>
</head>
<body>

<div class="header">
    <img src="https://i.imgur.com/75tlt7m.png" alt="Logo">
    <h2>Manajemen Stok Kaos Polos</h2>
    <button id="loginBtn" class="login-btn" onclick="toggleLoginForm()">Login Admin</button>
</div>

<div class="container">
    <!-- Form Login -->
    <div id="loginForm" class="form-container hidden">
        <h3>Login Admin</h3>
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Masukkan username" value="admin">

        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Masukkan password">

        <button type="button" onclick="login()">Login</button>
    </div>

    <!-- Form Input Stok -->
    <div id="stockInputForm" class="form-container hidden">
        <h3>Input Stok Baru</h3>
        <form id="stockForm" class="form-grid">
            <div>
                <label for="warna">Warna:</label>
                <select id="warna">
                    <option value="Putih">Putih</option>
                    <option value="Broken White">Broken White</option>
                    <option value="Abu Muda">Abu Muda</option>
                    <option value="Abu Sedang">Abu Sedang</option>
                    <option value="Abu Tua">Abu Tua</option>
                    <option value="Hitam Reaktif">Hitam Reaktif</option>
                    <option value="Hitam Sulfur">Hitam Sulfur</option>
                    <option value="Hitam Supersoft">Hitam Supersoft</option>
                    <option value="Charcoal">Charcoal</option>
                    <option value="Navy">Navy</option>
                    <option value="Hijau Botol">Hijau Botol</option>
                    <option value="Hijau Pucuk">Hijau Pucuk</option>
                    <option value="Army">Army</option>
                    <option value="Sage">Sage</option>
                    <option value="Biru Langit">Biru Langit</option>
                    <option value="Biru Elektrik">Biru Elektrik</option>
                    <option value="Biru Dongker">Biru Dongker</option>
                    <option value="Kuning Lemon">Kuning Lemon</option>
                    <option value="Kuning Mustard">Kuning Mustard</option>
                    <option value="Oranye">Oranye</option>
                    <option value="Salmon">Salmon</option>
                    <option value="Merah Cabe">Merah Cabe</option>
                    <option value="Merah Marun">Merah Marun</option>
                    <option value="Coklat Tua">Coklat Tua</option>
                    <option value="Coklat Muda">Coklat Muda</option>
                    <option value="Pink Muda">Pink Muda</option>
                    <option value="Dusty Pink">Dusty Pink</option>
                    <option value="Ungu Muda">Ungu Muda</option>
                    <option value="Ungu Lavender">Ungu Lavender</option>
                    <option value="Toska Muda">Toska Muda</option>
                    <option value="Mint">Mint</option>
                </select>
            </div>

            <div>
                <label for="size">Size:</label>
                <select id="size">
                    <option value="XS">XS</option>
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                    <option value="XL">XL</option>
                    <option value="2XL">2XL</option>
                    <option value="3XL">3XL</option>
                    <option value="4XL">4XL</option>
                    <option value="5XL">5XL</option>
                    <option value="6XL">6XL</option>
                </select>
            </div>

            <div>
                <label for="varian">Varian:</label>
                <select id="varian">
                    <option value="DEWASA">DEWASA</option>
                    <option value="ANAK">ANAK</option>
                </select>
            </div>

            <div>
                <label for="lengan">Lengan:</label>
                <select id="lengan">
                    <option value="PENDEK">PENDEK</option>
                    <option value="PANJANG">PANJANG</option>
                    <option value="3/4">3/4</option>
                    <option value="7/8">7/8</option>
                    <option value="TANPA LENGAN">TANPA LENGAN</option>
                </select>
            </div>

            <div class="full-width">
                <label for="gramasi">Gramasi:</label>
                <select id="gramasi">
                    <option value="30S">30S</option>
                    <option value="24S">24S</option>
                    <option value="20S">20S</option>
                    <option value="16S">16S</option>
                </select>
            </div>

            <div class="full-width">
                <label for="model">Model:</label>
                <select id="model">
                    <option value="OBLONG">OBLONG</option>
                    <option value="V-NECK">V-NECK</option>
                    <option value="KERAH">KERAH</option>
                    <option value="RAGLAN">RAGLAN</option>
                    <option value="MOTIF">MOTIF</option>
                </select>
            </div>

            <div class="full-width">
                <label for="jenisBahan">Jenis Bahan:</label>
                <select id="jenisBahan">
                    <option value="COMBED">COMBED</option>
                    <option value="CARDED">CARDED</option>
                    <option value="PE">PE</option>
                    <option value="TC">TC</option>
                    <option value="LAKOS">LAKOS</option>
                </select>
            </div>

            <div class="full-width">
                <label for="jumlah">Jumlah:</label>
                <input type="number" id="jumlah" placeholder="Masukkan jumlah">
            </div>

            <button type="button" class="full-width" onclick="addStock()">Tambah Stok</button>
        </form>
    </div>

    <!-- Informasi untuk customer -->
    <div class="customer-notice" id="customerNotice">
        üîç Halaman ini hanya menampilkan stok tersedia. Untuk manajemen stok, harap login sebagai admin.
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Cari stok..." onkeyup="searchStock()">
    </div>

    <!-- Tabel Stok -->
    <h3>Stok Tersedia</h3>
    <table id="stockTable">
        <thead>
            <tr>
                <th>Warna</th>
                <th>Size</th>
                <th>Varian</th>
                <th>Lengan</th>
                <th>Gramasi</th>
                <th>Model</th>
                <th>Jenis Bahan</th>
                <th>Jumlah</th>
                <th class="admin-only">Aksi</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data stok akan ditampilkan di sini -->
        </tbody>
    </table>
</div>
<script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // Konfigurasi Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAmSWqMZ4Nrc4905V8EEB83oJs0IB0EATQ",
  authDomain: "stok-kaos.firebaseapp.com",
  databaseURL: "https://stok-kaos-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "stok-kaos",
  storageBucket: "stok-kaos.firebasestorage.app",
  messagingSenderId: "423425283384",
  appId: "1:423425283384:web:a6bb4aafa22a6daaac1dcd"
    };

    // Inisialisasi Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let isAdminLoggedIn = false;

    async function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        try {
            await signInWithEmailAndPassword(auth, username, password);
            isAdminLoggedIn = true;
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('stockInputForm').classList.remove('hidden');
            document.getElementById('customerNotice').classList.add('hidden');
            document.getElementById('loginBtn').classList.add('hidden');
            loadStockData();
            showNotification('Login berhasil!', 'success');
        } catch (error) {
            showNotification('Login gagal: ' + error.message, 'error');
        }
    }

    async function logout() {
        await signOut(auth);
        isAdminLoggedIn = false;
        document.getElementById('stockInputForm').classList.add('hidden');
        document.getElementById('customerNotice').classList.remove('hidden');
        document.getElementById('loginBtn').classList.remove('hidden');
        showNotification('Anda telah logout.', 'success');
    }

    async function loadStockData() {
        const table = document.getElementById('stockTable').getElementsByTagName('tbody')[0];
        table.innerHTML = '';

        const querySnapshot = await getDocs(collection(db, "stocks"));
        querySnapshot.forEach((doc) => {
            const stock = doc.data();
            if (stock.jumlah > 0) {
                const newRow = table.insertRow();
                newRow.insertCell(0).innerText = stock.warna;
                newRow.insertCell(1).innerText = stock.size;
                newRow.insertCell(2).innerText = stock.varian;
                newRow.insertCell(3).innerText = stock.lengan;
                newRow.insertCell(4).innerText = stock.gramasi;
                newRow.insertCell(5).innerText = stock.model;
                newRow.insertCell(6).innerText = stock.jenisBahan;
                newRow.insertCell(7).innerText = stock.jumlah;
                const actionCell = newRow.insertCell(8);
                if (isAdminLoggedIn) {
                    actionCell.innerHTML = `<button onclick="editStock('${doc.id}', 1)">+</button> <button onclick="editStock('${doc.id}', -1)">-</button>`;
                }
            }
        });
    }

    async function addStock() {
        if (!isAdminLoggedIn) {
            showNotification('Anda harus login sebagai admin!', 'error');
            return;
        }

        const warna = document.getElementById('warna').value;
        const size = document.getElementById('size').value;
        const varian = document.getElementById('varian').value;
        const lengan = document.getElementById('lengan').value;
        const gramasi = document.getElementById('gramasi').value;
        const model = document.getElementById('model').value;
        const jenisBahan = document.getElementById('jenisBahan').value;
        const jumlah = parseInt(document.getElementById('jumlah').value);

        if (isNaN(jumlah) || jumlah <= 0) {
            showNotification('Masukkan jumlah yang valid!', 'error');
            return;
        }

        await addDoc(collection(db, "stocks"), {
            warna, size, varian, lengan, gramasi, model, jenisBahan, jumlah
        });

        loadStockData();
        showNotification('Stok berhasil ditambahkan!', 'success');
    }

    async function editStock(stockId, change) {
        if (!isAdminLoggedIn) {
            showNotification('Anda harus login sebagai admin!', 'error');
            return;
        }

        const stockRef = doc(db, "stocks", stockId);
        const stockSnap = await getDoc(stockRef);
        if (stockSnap.exists()) {
            let newJumlah = stockSnap.data().jumlah + change;
            if (newJumlah < 0) newJumlah = 0;
            await updateDoc(stockRef, { jumlah: newJumlah });
            loadStockData();
            showNotification('Jumlah stok berhasil diperbarui!', 'success');
        }
    }
</script>
<script>
    let isAdminLoggedIn = false;

    // Fungsi untuk menampilkan/sembunyikan form login
    function toggleLoginForm() {
        const loginForm = document.getElementById('loginForm');
        loginForm.classList.toggle('hidden');
    }

    // Fungsi untuk login
    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if (username === 'admin' && password === 'knvs1234') {
            isAdminLoggedIn = true;
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('stockInputForm').classList.remove('hidden');
            document.getElementById('customerNotice').classList.add('hidden');
            document.getElementById('loginBtn').classList.add('hidden');
            loadStockData();
            showNotification('Login berhasil!', 'success');
        } else {
            showNotification('Username atau password salah!', 'error');
        }
    }

    // Fungsi untuk logout
    function logout() {
        isAdminLoggedIn = false;
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('stockInputForm').classList.add('hidden');
        document.getElementById('customerNotice').classList.remove('hidden');
        document.getElementById('loginBtn').classList.remove('hidden');
        loadStockData();
        showNotification('Anda telah logout.', 'success');
    }

    // Fungsi untuk memuat data stok
    function loadStockData() {
        const stockList = JSON.parse(localStorage.getItem('stockList')) || [];
        const table = document.getElementById('stockTable').getElementsByTagName('tbody')[0];
        table.innerHTML = '';

        stockList.forEach((stock, index) => {
            // Hanya tampilkan stok dengan jumlah > 0
            if (stock.jumlah > 0) {
                const newRow = table.insertRow();
                newRow.insertCell(0).innerHTML = stock.warna;
                newRow.insertCell(1).innerHTML = stock.size;
                newRow.insertCell(2).innerHTML = stock.varian;
                newRow.insertCell(3).innerHTML = stock.lengan;
                newRow.insertCell(4).innerHTML = stock.gramasi;
                newRow.insertCell(5).innerHTML = stock.model;
                newRow.insertCell(6).innerHTML = stock.jenisBahan;
                newRow.insertCell(7).innerHTML = stock.jumlah;
                
                const actionCell = newRow.insertCell(8);
                if(isAdminLoggedIn) {
                    actionCell.innerHTML = `<button onclick="editStock(${index}, 1)">+</button> <button onclick="editStock(${index}, -1)">-</button>`;
                } else {
                    actionCell.innerHTML = '';
                }
            }
        });

        // Sembunyikan kolom aksi untuk customer
        document.querySelectorAll('.admin-only').forEach(el => {
            el.style.display = isAdminLoggedIn ? 'table-cell' : 'none';
        });
    }

    // Fungsi untuk mengedit stok
    function editStock(index, change) {
        if(!isAdminLoggedIn) {
            showNotification('Anda harus login sebagai admin!', 'error');
            return;
        }
        
        let stockList = JSON.parse(localStorage.getItem('stockList')) || [];
        stockList[index].jumlah += change;
        if (stockList[index].jumlah < 0) stockList[index].jumlah = 0;
        localStorage.setItem('stockList', JSON.stringify(stockList));
        loadStockData();
        showNotification('Jumlah stok berhasil diupdate!', 'success');
    }

    // Fungsi untuk menambahkan stok
    function addStock() {
        if(!isAdminLoggedIn) {
            showNotification('Anda harus login sebagai admin!', 'error');
            return;
        }
        
        const warna = document.getElementById('warna').value;
        const size = document.getElementById('size').value;
        const varian = document.getElementById('varian').value;
        const lengan = document.getElementById('lengan').value;
        const gramasi = document.getElementById('gramasi').value;
        const model = document.getElementById('model').value;
        const jenisBahan = document.getElementById('jenisBahan').value;
        const jumlah = parseInt(document.getElementById('jumlah').value);

        if (!warna || !size || !varian || !lengan || !gramasi || !model || !jenisBahan || isNaN(jumlah)) {
            showNotification('Harap isi semua field dengan benar!', 'error');
            return;
        }

        const stockList = JSON.parse(localStorage.getItem('stockList')) || [];
        stockList.push({ warna, size, varian, lengan, gramasi, model, jenisBahan, jumlah });
        localStorage.setItem('stockList', JSON.stringify(stockList));
        loadStockData();
        showNotification('Stok berhasil ditambahkan!', 'success');
    }

    // Fungsi pencarian
    function searchStock() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.getElementById('stockTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr');

        Array.from(rows).forEach(row => {
            const cells = row.getElementsByTagName('td');
            const color = cells[0].innerText.toLowerCase();
            const size = cells[1].innerText.toLowerCase();
            const varian = cells[2].innerText.toLowerCase();
            const lengan = cells[3].innerText.toLowerCase();
            const gramasi = cells[4].innerText.toLowerCase();
            const model = cells[5].innerText.toLowerCase();
            const bahan = cells[6].innerText.toLowerCase();
            const jumlah = cells[7].innerText.toLowerCase();

            const match = color.includes(searchInput) || size.includes(searchInput) || varian.includes(searchInput) ||
                          lengan.includes(searchInput) || gramasi.includes(searchInput) || model.includes(searchInput) ||
                          bahan.includes(searchInput) || jumlah.includes(searchInput);

            row.style.display = match ? '' : 'none';
        });
    }

    // Fungsi untuk menampilkan notifikasi
    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerText = message;
        document.querySelector('.container').prepend(notification);
        setTimeout(() => notification.remove(), 3000);
    }

    // Memuat data stok saat haalaman dimuat
    window.onload = function() {
        loadStockData();
    };
</script>

</body>
</html>