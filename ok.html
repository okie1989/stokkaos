<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Stok Kaos Polos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #4CAF50;
            padding: 10px 20px;
            color: white;
        }
        .header img {
            height: 50px;
        }
        .login-btn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .login-btn:hover {
            background-color: #45a049;
        }
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .form-grid > div {
            display: contents;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f9f9f9;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .hidden {
            display: none;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .logout-btn {
            background-color: #f44336;
        }
        .notification {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            color: white;
        }
        .notification.success {
            background-color: #4CAF50;
        }
        .notification.error {
            background-color: #f44336;
        }
        .customer-notice {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border: 1px solid #ffeeba;
        }
    </style>

</head>
<body>
    <div class="header">
        <img src="https://i.imgur.com/75tlt7m.png" alt="Logo">
        <h2>Manajemen Stok Kaos Polos</h2>
        <button id="loginBtn">Login Admin</button>
    </div>

    <!-- Form Login -->
    <div id="loginForm" class="form-container hidden">
        <h3>Login Admin</h3>
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Masukkan username" value="admin">
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Masukkan password">
        <button type="button" id="submitLogin">Login</button>
    </div>

    <!-- Form Input Stok -->
    <div id="stockInputForm" class="form-container hidden">
        <h3>Input Stok Baru</h3>
        <form id="stockForm" class="form-grid">
            <!-- ... (Form input stok) ... -->
        </form>
    </div>

    <!-- Informasi untuk customer -->
    <div class="customer-notice" id="customerNotice">
        üîç Halaman ini hanya menampilkan stok tersedia. Untuk manajemen stok, harap login sebagai admin.
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Cari stok..." onkeyup="searchStock()">
    </div>

    <!-- Tabel Stok -->
    <h3>Stok Tersedia</h3>
    <table id="stockTable">
        <thead>
            <tr>
                <th>Warna</th>
                <th>Size</th>
                <th>Varian</th>
                <th>Lengan</th>
                <th>Gramasi</th>
                <th>Model</th>
                <th>Jenis Bahan</th>
                <th>Jumlah</th>
                <th class="admin-only">Aksi</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data stok akan ditampilkan di sini -->
        </tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            updateDoc, 
            doc 
        } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            signOut 
        } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";

        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAmSWqMZ4Nrc4905V8EEB83oJs0IB0EATQ",
            authDomain: "stok-kaos.firebaseapp.com",
            projectId: "stok-kaos",
            storageBucket: "stok-kaos.firebasestorage.app",
            messagingSenderId: "423425283384",
            appId: "1:423425283384:web:a6bb4aafa22a6daaac1dcd"
        };

        // Inisialisasi Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let isAdminLoggedIn = false;

        // Fungsi untuk toggle form login
        const toggleLoginForm = () => {
            const loginForm = document.getElementById('loginForm');
            loginForm.classList.toggle('hidden');
        };

        // Fungsi login
        const login = async () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                await signInWithEmailAndPassword(auth, username, password);
                isAdminLoggedIn = true;
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('stockInputForm').classList.remove('hidden');
                document.getElementById('customerNotice').classList.add('hidden');
                document.getElementById('loginBtn').classList.add('hidden');
                showNotification('Login berhasil!', 'success');
                await loadStockData();
            } catch (error) {
                showNotification('Login gagal: ' + error.message, 'error');
            }
        };

        // Fungsi logout
        const logout = async () => {
            await signOut(auth);
            isAdminLoggedIn = false;
            document.getElementById('stockInputForm').classList.add('hidden');
            document.getElementById('customerNotice').classList.remove('hidden');
            document.getElementById('loginBtn').classList.remove('hidden');
            showNotification('Anda telah logout.', 'success');
        };

        // Fungsi untuk memuat data stok
        const loadStockData = async () => {
            const table = document.getElementById('stockTable').getElementsByTagName('tbody')[0];
            table.innerHTML = '';

            const querySnapshot = await getDocs(collection(db, "stocks"));
            querySnapshot.forEach((doc) => {
                const stock = doc.data();
                if (stock.jumlah > 0) {
                    const newRow = table.insertRow();
                    newRow.insertCell(0).innerText = stock.warna;
                    newRow.insertCell(1).innerText = stock.size;
                    newRow.insertCell(2).innerText = stock.varian;
                    newRow.insertCell(3).innerText = stock.lengan;
                    newRow.insertCell(4).innerText = stock.gramasi;
                    newRow.insertCell(5).innerText = stock.model;
                    newRow.insertCell(6).innerText = stock.jenisBahan;
                    newRow.insertCell(7).innerText = stock.jumlah;

                    if (isAdminLoggedIn) {
                        const actionCell = newRow.insertCell(8);
                        actionCell.innerHTML = `
                            <button onclick="editStock('${doc.id}', 1)">+</button>
                            <button onclick="editStock('${doc.id}', -1)">-</button>
                        `;
                    }
                }
            });
        };

        // Fungsi untuk menambahkan stok
        const addStock = async () => {
            const warna = document.getElementById('warna').value;
            const size = document.getElementById('size').value;
            const varian = document.getElementById('varian').value;
            const lengan = document.getElementById('lengan').value;
            const gramasi = document.getElementById('gramasi').value;
            const model = document.getElementById('model').value;
            const jenisBahan = document.getElementById('jenisBahan').value;
            const jumlah = parseInt(document.getElementById('jumlah').value);

            if (isNaN(jumlah) || jumlah <= 0) {
                showNotification('Masukkan jumlah yang valid!', 'error');
                return;
            }

            try {
                await addDoc(collection(db, "stocks"), {
                    warna, size, varian, lengan, gramasi, model, jenisBahan, jumlah
                });
                showNotification('Stok berhasil ditambahkan!', 'success');
                await loadStockData();
            } catch (error) {
                showNotification('Gagal menambah stok: ' + error.message, 'error');
            }
        };

        // Fungsi untuk mengedit stok
        const editStock = async (stockId, change) => {
            if (!isAdminLoggedIn) {
                showNotification('Anda harus login sebagai admin!', 'error');
                return;
            }

            const stockRef = doc(db, "stocks", stockId);
            const stockSnap = await getDoc(stockRef);
            if (stockSnap.exists()) {
                let newJumlah = stockSnap.data().jumlah + change;
                if (newJumlah < 0) newJumlah = 0;
                await updateDoc(stockRef, { jumlah: newJumlah });
                await loadStockData();
                showNotification('Jumlah stok berhasil diperbarui!', 'success');
            }
        };

        // Fungsi untuk menampilkan notifikasi
        const showNotification = (message, type) => {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerText = message;
            document.querySelector('.container').prepend(notification);
            setTimeout(() => notification.remove(), 3000);
        };

        // Event listener
        document.getElementById("loginBtn").addEventListener("click", toggleLoginForm);
        document.getElementById("submitLogin").addEventListener("click", login);

        // Muat data stok saat halaman dimuat
        window.onload = loadStockData;

        // Ekspos fungsi ke global scope
        window.addStock = addStock;
        window.editStock = editStock;
    </script>
</body>
</html>